<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizzes | LearnMatrix</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <header>
        <a href="/LearnMatrix/" class="logo">
            <img src="assets/images/logo.png" alt="Compass"
                style="height: 30px; vertical-align: middle; margin-right: 5px;">
            LearnMatrix
        </a>
        <nav>
            <ul>
                <li><a href="/LearnMatrix/">Home</a></li>
                <li><a href="/LearnMatrix/about.html">About</a></li>
                <li><a href="/LearnMatrix/resources.html">Resources</a></li>
                <li><a href="/LearnMatrix/schedule.html">Schedule</a></li>
                <li><a href="/LearnMatrix/dashboard.html">Dashboard</a></li>
                <li><a href="/LearnMatrix/quizzes.html" class="active">Quiz</a></li>
                <li><a href="/LearnMatrix/login.html" class="user-profile"
                        style="color: #fff; text-decoration: none; font-size: 1.2rem;">üë§</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- SUBJECT SELECTION -->
        <div id="subject-selection" class="subject-selection-clean fade-in" style="padding: 2rem 0;">
            <div class="hero">
                <h1>Matrix Archives</h1>
                <p>Knowledge is the ultimate currency. Select your specialization.</p>
            </div>

            <section class="features" style="margin-top: 2rem;">
                <div class="feature-card" onclick="selectSubject('AP Micro')">
                    <div class="card-image-placeholder"
                        style="background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);">
                        <span style="font-size: 3rem;">üìâ</span>
                    </div>
                    <div class="card-content">
                        <h3>AP Microeconomics</h3>
                        <p>Market behaviors and individual decision making.</p>
                        <span class="btn-link">Explore Units &rarr;</span>
                    </div>
                </div>
                <div class="feature-card" onclick="selectSubject('AP Macro')">
                    <div class="card-image-placeholder"
                        style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <span style="font-size: 3rem;">üåç</span>
                    </div>
                    <div class="card-content">
                        <h3>AP Macroeconomics</h3>
                        <p>Global economic systems and national indicators.</p>
                        <span class="btn-link">Explore Units &rarr;</span>
                    </div>
                </div>
                <div class="feature-card" onclick="selectSubject('AP Statistics')">
                    <div class="card-image-placeholder"
                        style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <span style="font-size: 3rem;">üìä</span>
                    </div>
                    <div class="card-content">
                        <h3>AP Statistics</h3>
                        <p>Probability patterns and data-driven inference.</p>
                        <span class="btn-link">Explore Units &rarr;</span>
                    </div>
                </div>
                <div class="feature-card" onclick="selectSubject('AP Euro')">
                    <div class="card-image-placeholder"
                        style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <span style="font-size: 3rem;">üè∞</span>
                    </div>
                    <div class="card-content">
                        <h3>AP European History</h3>
                        <p>The cultural and political evolution of Europe.</p>
                        <span class="btn-link">Explore Units &rarr;</span>
                    </div>
                </div>
            </section>
        </div>

        <!-- UNIT SELECTION -->
        <div id="unit-selection" class="quiz-hud-container fade-in" style="display: none;">
            <div class="quiz-hud-card">
                <div class="hud-header">
                    <div>
                        <button onclick="exitQuiz()" class="btn-link"
                            style="color: rgba(255,255,255,0.4); text-decoration: none; font-size: 0.9rem;">[BACK TO
                            ARCHIVES]</button>
                    </div>
                    <div class="hud-stat-group">
                        <div class="hud-label">Specialization</div>
                        <div id="selected-subject-name" class="hud-value" style="font-size: 1.2rem;">AP MICRO</div>
                    </div>
                </div>
                <h2 style="margin-bottom: 2rem; font-weight: 300;">Select Training Module</h2>
                <div id="unit-grid" class="options-hud-grid">
                    <!-- Units injected here -->
                </div>
            </div>
        </div>

        <!-- NEW HUD INTERFACE -->
        <div id="quiz-hud" class="quiz-hud-container" style="display: none;">
            <div id="hud-card" class="quiz-hud-card fade-in">
                <div id="streak-badge" class="streak-hud-badge">üî• 3 STREAK</div>
                <div class="success-glow" id="success-glow"></div>

                <div class="hud-header">
                    <div>
                        <button onclick="cancelToUnits()" class="btn-link"
                            style="color: rgba(255,255,255,0.4); text-decoration: none; font-size: 0.9rem;">[ABORT
                            SESSION]</button>
                    </div>
                    <div style="display: flex; gap: 3rem;">
                        <div class="hud-stat-group">
                            <div class="hud-label">Current Score</div>
                            <div id="hud-score" class="hud-value">0000</div>
                        </div>
                        <div class="hud-stat-group">
                            <div class="hud-label">Session Progress</div>
                            <div id="hud-stats" class="hud-value">01 / 10</div>
                        </div>
                    </div>
                </div>

                <div class="progress-container"
                    style="margin: -1.5rem 0 3rem 0; height: 4px; background: rgba(255,255,255,0.05);">
                    <div id="progress-bar" class="progress-bar"
                        style="height: 100%; box-shadow: 0 0 15px var(--primary-color);"></div>
                </div>

                <div class="question-hud">
                    <h2 id="question-text">Initializing Question...</h2>
                    <div class="options-hud-grid" id="options-grid">
                        <!-- Options injected here -->
                    </div>
                </div>

                <div class="quiz-footer" style="padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.05);">
                    <button id="next-btn" class="btn" style="display: none; width: 200px;" onclick="nextQuestion()">NEXT
                        SCAN &rarr;</button>
                </div>
            </div>
        </div>

        <!-- SUMMARY SCREEN -->
        <div id="summary-screen" class="quiz-hud-container" style="display: none;">
            <div class="quiz-hud-card fade-in" style="text-align: center;">
                <h1 id="result-title" style="margin-bottom: 2rem;">ANALYSIS COMPLETE</h1>
                <div class="score-circle">
                    <div id="final-score" class="score-num">0</div>
                    <div class="hud-label">TOTAL XP</div>
                </div>
                <p id="result-msg" style="margin: 2rem 0; font-size: 1.2rem; opacity: 0.8;">Synchronization successful.
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 3rem;">
                    <button class="btn" onclick="retryQuiz()">RE-INITIALIZE</button>
                    <button class="btn btn-secondary" onclick="cancelToUnits()">SELECT UNIT</button>
                </div>
            </div>
        </div>
    </main>

    <footer class="premium-footer">
        <div class="footer-content">
            <div class="footer-brand">
                <a href="/LearnMatrix/" class="logo">LearnMatrix</a>
                <p>Empowering students to learn smarter.</p>
            </div>
            <div class="footer-links">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="/LearnMatrix/">Home</a></li>
                    <li><a href="/LearnMatrix/about.html">About</a></li>
                    <li><a href="/LearnMatrix/resources.html">Resources</a></li>
                    <li><a href="/LearnMatrix/chatbot.html">Chatbot</a></li>
                </ul>
            </div>
            <div class="footer-social">
                <h4>Connect</h4>
                <div class="social-icons">
                    <a href="https://www.instagram.com/learnmatrixap/?igsh=NTlycml2aTk0YWdn&utm_source=qr#"
                        class="social-icon" target="_blank">IG</a>
                    <a href="#" class="social-icon">FB</a>
                    <a href="#" class="social-icon">X</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 LearnMatrix. All rights reserved.</p>
        </div>
    </footer>

    <script>
        let currentQuizData = null;
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let streak = 0;
        let maxQuestions = 10;
        let selectedAnswer = null;
        let activeSubject = null;
        let activeUnit = null;

        async function loadQuizData() {
            try {
                const response = await fetch('assets/data/quizzes.json');
                currentQuizData = await response.json();
                console.log('Matrix archives accessed');
            } catch (error) {
                console.error('Archive link severed:', error);
            }
        }

        function selectSubject(subject) {
            activeSubject = subject;
            document.getElementById('subject-selection').style.display = 'none';
            document.getElementById('unit-grid').innerHTML = '';
            document.getElementById('selected-subject-name').innerText = subject;

            const units = Object.keys(currentQuizData[subject]);
            units.forEach((unit, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-hud-btn fade-in';
                btn.style.animationDelay = `${index * 0.1}s`;
                btn.innerHTML = `
                    <div class="option-prefix">${index + 1}</div>
                    <div class="option-content">${unit}</div>
                `;
                btn.onclick = () => startQuiz(subject, unit);
                document.getElementById('unit-grid').appendChild(btn);
            });

            document.getElementById('unit-selection').style.display = 'block';
        }

        function cancelToUnits() {
            document.getElementById('quiz-hud').style.display = 'none';
            document.getElementById('summary-screen').style.display = 'none';
            document.getElementById('unit-selection').style.display = 'block';
        }

        function startQuiz(subject, unit) {
            activeSubject = subject;
            activeUnit = unit;

            if (!currentQuizData[subject] || !currentQuizData[subject][unit]) {
                alert("Data packets not found for: " + subject + " " + unit);
                return;
            }

            const allQuestions = currentQuizData[subject][unit];
            // Shuffle and pick 10
            questions = [...allQuestions].sort(() => 0.5 - Math.random()).slice(0, maxQuestions);

            currentQuestionIndex = 0;
            score = 0;
            streak = 0;

            document.getElementById('unit-selection').style.display = 'none';
            document.getElementById('summary-screen').style.display = 'none';
            document.getElementById('quiz-hud').style.display = 'block';

            document.getElementById('hud-score').innerText = '0000';

            showQuestion();
        }

        function showQuestion() {
            const q = questions[currentQuestionIndex];
            selectedAnswer = null;

            const qText = document.getElementById('question-text');
            qText.innerText = q.question;
            qText.className = 'fade-in';

            const optionsGrid = document.getElementById('options-grid');
            optionsGrid.innerHTML = '';

            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-hud-btn fade-in';
                btn.style.animationDelay = `${index * 0.1}s`;
                btn.innerHTML = `
                    <div class="option-prefix">${String.fromCharCode(65 + index)}</div>
                    <div class="option-content">${opt}</div>
                `;
                btn.onclick = () => selectOption(index, btn);
                optionsGrid.appendChild(btn);
            });

            document.getElementById('next-btn').style.display = 'none';
            updateProgress();
        }

        function selectOption(index, btn) {
            if (selectedAnswer !== null) return;

            selectedAnswer = index;
            const q = questions[currentQuestionIndex];
            const buttons = document.querySelectorAll('.option-hud-btn');

            if (index === q.answer) {
                btn.classList.add('correct');
                const baseXP = 100;
                const bonus = streak * 25;
                const earned = baseXP + bonus;

                score += earned;
                streak++;

                triggerSuccess();
                showStreakBadge(earned);
            } else {
                btn.classList.add('wrong');
                buttons[q.answer].classList.add('correct');
                streak = 0;
                hideStreakBadge();
                triggerFail();
            }

            animateScore(score);
            document.getElementById('next-btn').style.display = 'block';
        }

        function animateScore(target) {
            const scoreEl = document.getElementById('hud-score');
            const start = parseInt(scoreEl.innerText);
            const duration = 800;
            let startTime = null;

            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / duration, 1);
                const current = Math.floor(progress * (target - start) + start);
                scoreEl.innerText = current.toString().padStart(4, '0');
                if (progress < 1) window.requestAnimationFrame(step);
            }
            window.requestAnimationFrame(step);
        }

        function updateProgress() {
            const total = questions.length;
            const progress = ((currentQuestionIndex) / total) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('hud-stats').innerText = `${(currentQuestionIndex + 1).toString().padStart(2, '0')} / ${total.toString().padStart(2, '0')}`;
        }

        function triggerSuccess() {
            const glow = document.getElementById('success-glow');
            glow.style.opacity = '1';
            setTimeout(() => glow.style.opacity = '0', 1000);

            const card = document.getElementById('hud-card');
            card.style.transform = 'scale(1.02) rotateX(2deg)';
            setTimeout(() => card.style.transform = 'scale(1)', 300);
        }

        function triggerFail() {
            const card = document.getElementById('hud-card');
            card.style.animation = 'shake 0.4s ease-in-out';
            setTimeout(() => card.style.animation = '', 400);
        }

        function showStreakBadge(added) {
            const badge = document.getElementById('streak-badge');
            if (streak > 0) {
                badge.innerText = `üî• ${streak} STREAK (+${added} XP)`;
                badge.style.display = 'block';
            }
        }

        function hideStreakBadge() {
            document.getElementById('streak-badge').style.display = 'none';
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                showSummary();
            }
        }

        function showSummary() {
            document.getElementById('quiz-hud').style.display = 'none';
            document.getElementById('summary-screen').style.display = 'block';
            document.getElementById('final-score').innerText = score;

            let title = "ANALYSIS COMPLETE";
            let msg = "Neural sync successful. You've earned significant XP for this unit.";

            if (score > 1200) { title = "UNIT MASTER"; msg = "Absolute precision in this module. You are the Chosen One."; }
            else if (score < 500) { title = "SYNC FAILED"; msg = "Data corruption detected in this unit. Re-initialize for better results."; }

            document.getElementById('result-title').innerText = title;
            document.getElementById('result-msg').innerText = msg;
            document.getElementById('progress-bar').style.width = '100%';
        }

        function retryQuiz() {
            startQuiz(activeSubject, activeUnit);
        }

        function exitQuiz() {
            document.getElementById('quiz-hud').style.display = 'none';
            document.getElementById('unit-selection').style.display = 'none';
            document.getElementById('summary-screen').style.display = 'none';
            document.getElementById('subject-selection').style.display = 'block';
        }

        loadQuizData();
    </script>
    <script src="assets/js/script.js"></script>
</body>

</html>